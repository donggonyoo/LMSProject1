<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="prostu">
	<select id="findId" resultType="String" parameterType="FindIdDto">
	SELECT student_id 
	FROM student
	WHERE student_name = #{studentName} AND student_email=#{studentEmail}
	UNION
	SELECT professor_id 
	FROM professor
	WHERE professor_name = #{professorName} AND professor_email=#{professorEmail};
	</select>
	
	<select id="loginChk" resultType="java.util.HashMap" parameterType="LoginDto">
	SELECT student_id , student_name , student_password
	FROM student
	WHERE student_id = #{studentId} 
	UNION
	SELECT professor_id , professor_name ,professor_password
	FROM professor
	WHERE professor_id = #{professorId} 
	</select>
	
	<select id="findPw" resultType="String" parameterType="FindPwDto">
	SELECT student_password 
	FROM student
	WHERE student_id = #{studentId} AND student_email=#{studentEmail}
	UNION
	SELECT professor_password
	FROM professor
	WHERE professor_id = #{professorId} AND professor_email=#{professorEmail};
	</select>
	
	<update id="updateStuPw" parameterType="UpdateStuPwDto" >
		update student set student_password=#{studentNewPassword}
		where student_password=#{studentPassword} and student_id=#{studentId}
	</update>
	
	<update id="updateProPw" parameterType="UpdateProPwDto">
		update professor set professor_password=#{professorNewPassword}
		where professor_password=#{professorPassword} and professor_id=#{professorId}
	</update>
	
	<select id="selectDeptName" parameterType="String" resultType="String">
		select d.dept_name
		from student s inner join dept d on(s.dept_id = d.dept_id)
		where s.student_id = #{val}
		union
		select d.dept_name
		from professor p inner join dept d on(p.dept_id = d.dept_id)
		where p.professor_id = #{val}
	</select>
	
	<update id="updateProInfo" parameterType="UpdateProInfoDto">
	update professor 
	set professor_img=#{professorImg},
	professor_email=#{professorEmail},
	professor_phone=#{professorPhone}
	where professor_id = #{professorId}
	</update>
	
	<update id="updateStuInfo" parameterType="UpdateStuInfoDto">
	update student 
	set student_img=#{studentImg},
	student_email=#{studentEmail},
	student_phone=#{studentPhone}
	where student_id = #{studentId}
	</update>

</mapper>